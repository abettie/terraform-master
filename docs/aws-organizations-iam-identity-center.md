# AWS OrganizationsとIAM Identity Centerについて

このドキュメントでは、AWS OrganizationsとIAM Identity Centerの関係性と、それぞれの構成要素の関連について説明します。

## 概要

AWS OrganizationsとIAM Identity Centerを使用することで、複数のAWSアカウントを一元管理し、ユーザーのアクセス権限を効率的に制御できます。

## 構成要素の関係性

### AWS Organizations と AWSアカウント（1:n）

- **AWS Organizations**は複数のAWSアカウントを階層的に管理するサービスです
- 1つのAWS Organizationsに対して、複数のAWSアカウントを紐付けることができます
- Organization配下のアカウントは「メンバーアカウント」と呼ばれ、管理アカウント（旧マスターアカウント）から一元管理されます

```
AWS Organizations (1)
  └── AWSアカウント (n)
      ├── アカウントA
      ├── アカウントB
      └── アカウントC
```

### IAM Identity Center と ユーザー（1:n）

- **IAM Identity Center**（旧AWS SSO）は、ユーザーのアイデンティティを一元管理するサービスです
- 1つのIAM Identity Centerに対して、複数のユーザーを作成できます
- ユーザーは組織内の人員やシステムアカウントを表します

```
IAM Identity Center (1)
  └── ユーザー (n)
      ├── ユーザーA
      ├── ユーザーB
      └── ユーザーC
```

### IAM Identity Center と グループ（1:n）

- IAM Identity Centerでは、ユーザーを論理的にまとめる**グループ**を作成できます
- 1つのIAM Identity Centerに対して、複数のグループを作成できます
- グループを使用することで、権限管理を効率化できます

```
IAM Identity Center (1)
  └── グループ (n)
      ├── 管理者グループ
      ├── 開発者グループ
      └── 閲覧者グループ
```

### グループ と ユーザー（n:n）

- 1つのグループに複数のユーザーを所属させることができます
- 1人のユーザーは複数のグループに所属できます
- この多対多の関係により、柔軟な権限管理が可能になります

```
グループ (n) ←→ ユーザー (n)

管理者グループ ←→ ユーザーA
              ←→ ユーザーB

開発者グループ ←→ ユーザーB
              ←→ ユーザーC

閲覧者グループ ←→ ユーザーC
              ←→ ユーザーD
```

例：ユーザーBは「管理者グループ」と「開発者グループ」の両方に所属可能

### ユーザー と アカウント（n:n）

- 1人のユーザーは複数のAWSアカウントにアクセスできます
- 1つのAWSアカウントには複数のユーザーがアクセスできます
- アクセス許可セット（後述）を介して、どのアカウントにどの権限でアクセスできるかを制御します

```
ユーザー (n) ←→ アカウント (n)

ユーザーA ←→ アカウントA（管理者権限）
         ←→ アカウントB（読み取り専用）

ユーザーB ←→ アカウントA（開発者権限）
         ←→ アカウントC（管理者権限）
```

### アカウント と アクセス許可セット（n:n）

- **アクセス許可セット**（Permission Set）は、AWSアカウント上で付与する権限のテンプレートです
- 1つのAWSアカウントに対して、複数のアクセス許可セットを割り当てることができます
- 1つのアクセス許可セットは、複数のAWSアカウントで使用できます

```
アカウント (n) ←→ アクセス許可セット (n)

アカウントA ←→ AdministratorAccess
           ←→ PowerUserAccess
           ←→ ReadOnlyAccess

アカウントB ←→ AdministratorAccess
           ←→ ReadOnlyAccess
```

例：「AdministratorAccess」という1つのアクセス許可セットを、アカウントAとアカウントBの両方で使用可能

## 全体の関係図

```
AWS Organizations
  │
  ├── AWSアカウントA
  ├── AWSアカウントB
  └── AWSアカウントC
      ↑
      │ アクセス権限の割り当て
      │
IAM Identity Center
  │
  ├── ユーザー
  │   ├── ユーザーA
  │   ├── ユーザーB
  │   └── ユーザーC
  │
  ├── グループ
  │   ├── 管理者グループ（ユーザーA, B）
  │   └── 開発者グループ（ユーザーB, C）
  │
  └── アクセス許可セット
      ├── AdministratorAccess
      ├── PowerUserAccess
      └── ReadOnlyAccess
```

## 権限付与の仕組み

IAM Identity Centerを使用した権限付与は、以下のように行われます：

1. **ユーザー**（またはグループ）を選択
2. 対象の**AWSアカウント**を選択
3. 付与する**アクセス許可セット**を選択

この3つの組み合わせにより、「誰が」「どのアカウントに」「どの権限で」アクセスできるかが決定されます。

### 設定例

- 「管理者グループ」に所属する全ユーザーに対して
- 「アカウントA」へのアクセス権を付与
- 権限レベルは「AdministratorAccess」

この設定により、管理者グループに所属するユーザーAとユーザーBは、アカウントAに管理者権限でアクセスできるようになります。

## メリット

IAM Identity Centerを使用することで、以下のメリットがあります：

- **一元管理**: 複数のAWSアカウントへのアクセスを1箇所で管理
- **シングルサインオン**: 1回のログインで複数のアカウントにアクセス可能
- **セキュリティ向上**: 個別のIAMユーザーを作成する必要がなくなり、認証情報の管理が簡素化
- **柔軟な権限管理**: グループとアクセス許可セットの組み合わせで、複雑な権限要件に対応
- **監査の容易性**: アクセスログが一元化され、誰がどのアカウントにアクセスしたか追跡しやすい
